{% extends "base.html" %}

{% block title %}{{ recipe.name }} - Meal Planner{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-start mb-4 sm:mb-6">
        <a href="{% url 'recipe_list' %}" class="text-gray-500 hover:text-gray-700 text-sm">
            ← Back
        </a>
        <a href="{% url 'recipe_edit' recipe.pk %}"
           class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
            Edit
        </a>
    </div>

    <!-- Recipe Card -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <!-- Title Section -->
        <div class="p-4 sm:p-6 border-b border-gray-200">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">{{ recipe.name }}</h1>
            <div class="mt-2 sm:mt-3 flex flex-wrap items-center gap-2 sm:gap-4">
                <!-- Meal Type Badge -->
                <span class="inline-flex items-center px-2.5 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-medium"
                      style="background-color: {{ recipe.meal_type.colour }}20; color: {{ recipe.meal_type.colour }};">
                    {{ recipe.meal_type.name }}
                </span>

                <!-- Difficulty -->
                {% if recipe.difficulty %}
                <span class="flex items-center text-sm text-gray-600">
                    {% for i in "123" %}
                        {% if forloop.counter <= recipe.difficulty %}
                        <span class="text-yellow-400 text-base sm:text-lg">●</span>
                        {% else %}
                        <span class="text-gray-300 text-base sm:text-lg">○</span>
                        {% endif %}
                    {% endfor %}
                    <span class="ml-1 text-xs sm:text-sm">{{ recipe.get_difficulty_display }}</span>
                </span>
                {% endif %}
            </div>
        </div>

        <!-- Ingredients Section -->
        {% if recipe.recipe_ingredients.all %}
        <div class="p-4 sm:p-6 border-b border-gray-200 bg-gray-50">
            <h2 class="text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4">Ingredients</h2>
            {% regroup recipe.recipe_ingredients.all by ingredient.category as ingredient_groups %}
            <div class="space-y-4">
                {% for group in ingredient_groups %}
                <div>
                    <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">{{ group.grouper.name }}</h3>
                    <ul class="space-y-1.5">
                        {% for ri in group.list %}
                        <li class="flex items-start text-sm sm:text-base">
                            <span class="text-indigo-500 mr-2">•</span>
                            <span class="text-gray-700">
                                <strong>{{ ri.quantity }}</strong> {{ ri.ingredient.name }}{% if ri.ingredient.is_pantry_staple %} <span class="text-green-600 text-xs">(pantry)</span>{% endif %}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Instructions Section -->
        <div class="p-4 sm:p-6">
            <h2 class="text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4">Method</h2>
            <div class="prose text-gray-700 text-sm sm:text-base">
                {{ instructions_html|safe }}
            </div>
        </div>

        <!-- Reference Link -->
        {% if recipe.reference %}
        <div class="px-4 sm:px-6 py-4 bg-gray-50 border-t border-gray-200">
            <a href="{{ recipe.reference }}"
               target="_blank"
               rel="noopener noreferrer"
               class="inline-flex items-center text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                </svg>
                View original recipe
            </a>
        </div>
        {% endif %}

        <!-- Stats Footer -->
        <div class="px-4 sm:px-6 py-3 sm:py-4 bg-gray-50 border-t border-gray-200 text-xs sm:text-sm text-gray-500">
            Made {{ recipe.times_made }} time{{ recipe.times_made|pluralize }}
            {% with last=recipe.last_made %}
            {% if last %}
            · Last: {{ last|date:"j M Y" }}
            {% endif %}
            {% endwith %}
        </div>
    </div>

    <!-- Delete Button -->
    <div class="mt-4 sm:mt-6 text-center">
        <a href="{% url 'recipe_delete' recipe.pk %}"
           class="text-sm text-red-600 hover:text-red-800">
            Delete recipe
        </a>
    </div>
</div>
{% endblock %}
