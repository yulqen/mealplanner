{% extends "base.html" %}

{% block title %}Recipes - Meal Planner{% endblock %}

{% block content %}
<div class="space-y-4 sm:space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <h1 class="text-xl sm:text-2xl font-bold text-gray-900">Recipes</h1>
        <a href="{% url 'recipe_create' %}"
           class="inline-flex items-center px-3 sm:px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
            + <span class="hidden sm:inline ml-1">Add </span>Recipe
        </a>
    </div>

    <!-- Filters -->
    <div class="bg-white p-3 sm:p-4 rounded-lg shadow-sm">
        <form hx-get="{% url 'recipe_list' %}"
              hx-target="#recipe-list"
              hx-trigger="change, input delay:300ms from:#search-input"
              hx-push-url="true"
              class="space-y-3 sm:space-y-0 sm:flex sm:flex-wrap sm:gap-4 sm:items-end">

            <!-- Search + Ace Filter row -->
            <div class="flex gap-2 sm:gap-3 sm:flex-1 sm:min-w-[200px] sm:order-last items-end">
                <!-- Search -->
                <div class="flex-1">
                    <label for="search-input" class="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Search</label>
                    <input type="text" id="search-input" name="search" value="{{ current_search }}"
                           placeholder="Search recipes..."
                           class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base sm:text-sm px-3 py-2">
                </div>

                <!-- Ace Tag Filter -->
                <div class="pb-0.5 sm:pb-0">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="ace_tag" value="1"
                               {% if current_ace_tag %}checked{% endif %}
                               class="rounded border-gray-300 text-amber-500 focus:ring-amber-500 h-4 w-4">
                        <span class="ml-2 text-xs sm:text-sm font-medium text-gray-700">Ace only</span>
                    </label>
                </div>
            </div>

            <!-- Filter row on mobile -->
            <div class="grid grid-cols-2 gap-2 sm:contents">
                <!-- Meal Type Filter -->
                <div>
                    <label for="meal_type" class="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Type</label>
                    <select id="meal_type" name="meal_type"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-2 sm:px-3 py-2">
                        <option value="">All</option>
                        {% for mt in meal_types %}
                        <option value="{{ mt.id }}" {% if current_meal_type == mt.id|stringformat:"s" %}selected{% endif %}>
                            {{ mt.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Difficulty Filter -->
                <div>
                    <label for="difficulty" class="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Difficulty</label>
                    <select id="difficulty" name="difficulty"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-2 sm:px-3 py-2">
                        <option value="">Any</option>
                        <option value="1" {% if current_difficulty == "1" %}selected{% endif %}>Easy</option>
                        <option value="2" {% if current_difficulty == "2" %}selected{% endif %}>Med</option>
                        <option value="3" {% if current_difficulty == "3" %}selected{% endif %}>Hard</option>
                    </select>
                </div>

                <!-- Sort -->
                <div>
                    <label for="sort" class="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Sort</label>
                    <select id="sort" name="sort"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-2 sm:px-3 py-2">
                        <option value="name" {% if current_sort == "name" %}selected{% endif %}>Name</option>
                        <option value="times_made" {% if current_sort == "times_made" %}selected{% endif %}>Made</option>
                        <option value="last_made" {% if current_sort == "last_made" %}selected{% endif %}>Recent</option>
                    </select>
                </div>
            </div>
        </form>
    </div>

    <!-- Recipe List -->
    <div id="recipe-list">
        {% include "components/recipe_list_items.html" %}
    </div>
</div>
{% endblock %}
